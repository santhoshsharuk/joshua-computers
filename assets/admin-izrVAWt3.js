import{e as V,s as q,f,h as C,i as U,c as b,d as a,j as w,a as y,k as T,q as M,o as A,g as D,m as P,b as j}from"./firebase-X6STVwcq.js";const E=document.getElementById("login-form"),h=document.getElementById("add-product-form"),i=document.getElementById("product-list"),L=document.getElementById("logout-btn"),x=document.getElementById("error-msg");V(f,t=>{const e=window.location.pathname;t?(console.log("User is signed in:",t.email),e.includes("login.html")?window.location.href="dashboard.html":e.includes("dashboard.html")&&R()):(console.log("User is signed out"),e.includes("dashboard.html")&&(window.location.href="login.html"))});E&&E.addEventListener("submit",async t=>{t.preventDefault();const e=document.getElementById("email").value,n=document.getElementById("password").value;try{await q(f,e,n)}catch(o){x.textContent="Login failed: "+o.message,x.classList.remove("hidden")}});L&&L.addEventListener("click",()=>{C(f)});function R(){const t=document.querySelectorAll(".nav-item, .switch-view"),e=document.querySelectorAll(".view-section");t.forEach(n=>{n.addEventListener("click",o=>{o.preventDefault();const s=n.getAttribute("data-view");document.querySelectorAll(".nav-item").forEach(r=>r.classList.remove("active","bg-lightning-yellow","text-black")),n.classList.contains("nav-item")&&n.classList.add("active","bg-lightning-yellow","text-black"),e.forEach(r=>r.classList.add("hidden")),document.getElementById(`${s}-view`).classList.remove("hidden"),s==="dashboard"&&I(),s==="products"&&H(),s==="settings"&&F()})}),I()}async function I(){try{const t=M(b(a,"products"),A("createdAt","desc")),e=await D(t);let n=0,o=0,s=0;const r=new Date;r.setDate(r.getDate()-7);const l=[];e.forEach(c=>{n++;const u=c.data();u.condition==="Refurbished"&&s++;const m=u.createdAt?.toDate();m&&m>r&&(o++,l.push({name:u.name,date:m}))}),document.getElementById("total-products").textContent=n,document.getElementById("new-products").textContent=o,document.getElementById("refurb-products").textContent=s;const p=document.getElementById("recent-activity");l.length>0?p.innerHTML=l.slice(0,5).map(c=>`
        <div class="flex items-center justify-between py-2 border-b border-gray-800">
          <span class="text-sm">${c.name}</span>
          <span class="text-xs text-gray-500">${c.date.toLocaleDateString()}</span>
        </div>
      `).join(""):p.innerHTML='<p class="text-gray-500">No recent activity</p>'}catch(t){console.error("Error loading dashboard:",t)}}h&&h.addEventListener("submit",async t=>{t.preventDefault();const e=t.target.querySelector('button[type="submit"]');e.disabled=!0,e.innerHTML='<span class="inline-block animate-pulse">Adding...</span>';const n=document.getElementById("p-name").value,o=Number(document.getElementById("p-price").value),s=document.getElementById("p-brand").value,r=document.getElementById("p-processor").value,l=document.getElementById("p-ram").value,p=document.getElementById("p-ssd").value,c=document.getElementById("p-condition").value,u=document.getElementById("p-image").value,m=`Hi, I want to know more about ${n}`;try{await U(b(a,"products"),{name:n,price:o,brand:s,processor:r,ram:l,ssd:p,condition:c,imageUrl:u,whatsappMsg:m,createdAt:w()}),e.innerHTML="✓ Product Added!",e.classList.add("bg-green-600"),setTimeout(()=>{h.reset(),e.disabled=!1,e.innerHTML='<svg class="inline-block w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg> Add Product',e.classList.remove("bg-green-600"),document.querySelector('[data-view="products"]').click()},2e3)}catch($){console.error("Error adding product: ",$),e.disabled=!1,e.innerHTML="Error! Try again",e.classList.add("bg-red-600"),setTimeout(()=>{e.classList.remove("bg-red-600"),e.innerHTML='<svg class="inline-block w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg> Add Product'},2e3)}});async function H(){if(i){i.innerHTML='<p class="text-gray-500 col-span-full text-center py-10">Loading...</p>';try{const t=M(b(a,"products"),A("createdAt","desc")),e=await D(t);if(i.innerHTML="",e.empty){i.innerHTML='<p class="text-gray-500 col-span-full text-center py-10">No products found.</p>';return}e.forEach(n=>{const o=n.data(),s=n.id,r=document.createElement("div");r.className="card-premium p-5 flex flex-col",r.innerHTML=`
        <img src="${o.imageUrl}" alt="${o.name}" class="w-full h-48 object-cover rounded mb-4 bg-gray-800">
        <h3 class="text-lg font-bold text-white mb-1">${o.name}</h3>
        <p class="text-lightning-yellow font-bold text-2xl mb-2">₹${o.price.toLocaleString()}</p>
        <div class="text-sm text-gray-400 mb-4 space-y-1">
          <p>${o.brand} | ${o.condition}</p>
          <p>${o.processor}</p>
          <p>${o.ram} | ${o.ssd}</p>
        </div>
        <button class="delete-btn mt-auto bg-red-900/20 text-red-400 hover:bg-red-900/40 px-4 py-2 rounded transition text-sm" data-id="${s}">
          <svg class="inline-block w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
          </svg>
          Delete
        </button>
      `,i.appendChild(r)}),document.querySelectorAll(".delete-btn").forEach(n=>{n.addEventListener("click",N)})}catch(t){console.error("Error loading products:",t),i.innerHTML='<p class="text-red-500 col-span-full text-center py-10">Error loading products.</p>'}}}async function N(t){if(!confirm("Are you sure you want to delete this product?"))return;const e=t.currentTarget;e.disabled=!0,e.innerHTML='<span class="inline-block animate-pulse">Deleting...</span>';const n=e.getAttribute("data-id");try{await P(y(a,"products",n)),H()}catch(o){console.error("Error deleting product:",o),alert("Error deleting product."),e.disabled=!1,e.innerHTML="Delete"}}const B=document.getElementById("settings-form"),d=document.getElementById("youtube-url"),v=document.getElementById("video-preview"),k=document.getElementById("clear-video");function S(t){const e=[/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\n?#]+)/,/youtube\.com\/embed\/([^&\n?#]+)/];for(const n of e){const o=t.match(n);if(o)return o[1]}return null}d&&d.addEventListener("input",t=>{const e=t.target.value.trim();if(!e){v.innerHTML='<p class="text-gray-500">Video preview will appear here</p>';return}const n=S(e);n?v.innerHTML=`
        <iframe 
          width="100%" 
          height="100%" 
          src="https://www.youtube.com/embed/${n}" 
          frameborder="0" 
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
          allowfullscreen
          class="rounded-lg"
        ></iframe>
      `:v.innerHTML='<p class="text-red-500">Invalid YouTube URL</p>'});B&&B.addEventListener("submit",async t=>{t.preventDefault();const e=d.value.trim(),n=e?S(e):null;if(e&&!n){g("Invalid YouTube URL","error");return}try{const o=y(a,"settings","website");await T(o,{heroVideoUrl:e,heroVideoId:n,updatedAt:w()}),g("Settings saved successfully!","success")}catch(o){console.error("Error saving settings:",o),g("Error saving settings","error")}});k&&k.addEventListener("click",async()=>{if(confirm("Clear the hero video?"))try{const t=y(a,"settings","website");await T(t,{heroVideoUrl:"",heroVideoId:"",updatedAt:w()}),d.value="",v.innerHTML='<p class="text-gray-500">Video preview will appear here</p>',g("Video cleared successfully!","success")}catch(t){console.error("Error clearing video:",t),g("Error clearing video","error")}});async function F(){try{const t=y(a,"settings","website"),e=await j(t);if(e.exists()){const n=e.data();n.heroVideoUrl&&(d.value=n.heroVideoUrl,d.dispatchEvent(new Event("input")))}}catch(t){console.error("Error loading settings:",t)}}function g(t,e){const n=document.getElementById("settings-status");n.className=`mt-4 p-4 rounded-lg ${e==="success"?"bg-green-500/20 text-green-500":"bg-red-500/20 text-red-500"}`,n.textContent=t,n.classList.remove("hidden"),setTimeout(()=>{n.classList.add("hidden")},3e3)}
